window.ja = window.ja || {}, window.dataLayer = window.dataLayer || [], ja.sargs = function () { var t, e = Array.prototype.slice.call(arguments[0]); for (t in e) e[t] = JSON.stringify(e[t]); return ja.text.replace(e.join(" "), new RegExp('"', "gi"), "") }, ja.qs2 = function (t, e) { t = new RegExp("[?&]" + t + "=([^&#]*)").exec(window.location.href); return t && t[1] || e }, ja.qs = ja.qs2, ja.text = {}, ja.text.nul = function (t) { return null == t || "undefined" === t }, ja.text.empty = function (t) { if (ja.text.nul(t)) return !0; if ("object" == typeof t) try { t = t[0].value } catch (t) { } return 0 === ja.text.trim(t).length }, ja.text.unhtml = function (t) { var e = document.createElement("DIV"); return e.innerHTML = t, e.textContent || e.innerText || "" }, ja.text.trim = function (t) { var e = null != t ? t : ""; if (null !== e.trim && void 0 !== e.trim) try { e = e.trim() } catch (t) { } return e }, ja.text.lower = function (t) { var e = null != t ? t : ""; if (null !== e.toLowerCase && void 0 !== e.toLowerCase) try { e = e.toLowerCase() } catch (t) { } return e }, ja.text.indexOf = function (t, e) { var a = null != t ? t : "", o = -1; if (null !== a.indexOf && void 0 !== a.indexOf) try { o = a.indexOf(e) } catch (t) { } return o }, ja.text.indexof = ja.text.indexOf, ja.text.replace = function (t, e, a, o = 9) { var i = null != t ? t : ""; try { if (null !== i.replace && void 0 !== i.replace) i = i.replace(e, a); else for (var l = 0; -1 < ja.text.indexOf(i, e) && l++ < o;)i = i.replace(e, a) } catch (t) { ja.log.warn("ja.text.replace()", t) } return i }, ja.text.hash = function (t, e, a) { ja.text.nul(t) || (e ? ja.cache.set("hash", t, 15e3) : history.pushState ? history.pushState(null, null, "#" + t) : document.location.hash = t); t = document.location.hash.split("&")[0]; return ja.text.empty(t) && (t = ja.cache.get("hash")), ja.text.empty(t) ? "" : (ja.text.indexof(t, "#") < 0 && (t = "#" + t), t) }, ja.text.truncnumber = function (t) { t = new RegExp("(\\d+\\.\\d{" + t + "})(\\d)"), t = this.toString().match(t); return t ? parseFloat(t[1]) : this.valueOf() }, ja.text.shuffle = function (t) { let e, a = t.length; for (; 0 != a;)e = Math.floor(Math.random() * a), a--, [t[a], t[e]] = [t[e], t[a]]; return t }, ja.text.decode = function (t) { return (new DOMParser).parseFromString(t, "text/html").documentElement.textContent }, ja.text.clearto = function (t) { return ja.text.nul(t) || clearTimeout(t), t = null }, Number.prototype.trunc = function (t) { return ja.text.truncnumber(t) }, ja.log = { options: { loglevel: 5, dbg: "1" == ja.qs2("dbg"), log: ja.qs2("log") || "0" } }, ja.log.write = function () { ja.log.options.args = arguments, -1 < ["1", "2", "3"].indexOf(ja.log.options.log) && ja.ui.toast(ja.sargs(arguments), ja.log.options.loglevel), console.log.apply(console, arguments) }, ja.log.warn = function () { ja.log.options.args = arguments, -1 < ["3"].indexOf(ja.log.options.log) && ja.ui.toast(ja.sargs(arguments), ja.log.options.loglevel), console.warn.apply(console, arguments) }, ja.log.dbg = function () { ja.log.options.dbg && (ja.log.options.args = arguments, -1 < ["2", "3"].indexOf(ja.log.options.log) && ja.ui.toast(ja.sargs(arguments), ja.log.options.loglevel), console.log.apply(console, arguments)) }, ja.waiting = {}, ja.wait = function (t, e, a) { e() ? a() : ja.text.empty(t) ? ja.log.write("ja.wait(): missing key") : (ja.waiting[t] = ja.waiting[t] || {}, ja.text.nul(e) ? e = ja.waiting[t].condition : ja.waiting[t].condition = e, ja.text.nul(e) ? ja.log.write("ja.wait(): missing condition") : (ja.text.nul(a) ? a = ja.waiting[t].callback : ja.waiting[t].callback = a, ja.text.nul(a) ? ja.log.write("ja.wait(): missing callback") : setTimeout(function () { ja.wait(t, e, a) }, 250))) }, ja.event = {}, ja.event.prevent = function (t) { ja.text.nul(t) || (ja.text.nul(t.preventDefault) || t.preventDefault(), ja.text.nul(t.stopImmediatePropagation) || t.stopImmediatePropagation(), ja.text.nul(t.stopPropagation) || t.stopPropagation()) }, ja.event.lastevent = function (t) { return t || window.event }, ja.event.lasttarget = function (t) { return (t = ja.eventlastevent(t)).target || t.srcElement }, ja.gtm = {}, ja.gtm.init = function (t) { var e, a, o, i; e = window, a = document, o = "script", i = t, e[t = "dataLayer"] = e[t] || [], e[t].push({ "gtm.start": (new Date).getTime(), event: "gtm.js" }), t = a.getElementsByTagName(o)[0], (o = a.createElement(o)).async = !0, o.src = "https://www.googletagmanager.com/gtm.js?id=" + i, t.parentNode.insertBefore(o, t) }, ja.gtm.webevent = function (t, e, a) { return e = e || ja.text.replace(document.location.hostname, ".blogspot.com", "") + document.location.pathname + document.location.search, a = a || ja.geo.sz(), dataLayer.push({ event: "web.event", web_event_category: t, web_event_action: e, web_event_label: a }), this }, ja.error = ja.error || {}, ja.error.handle = function (t, e, a, o, i) { var l, n = ja.error.clean(t, "^uncaught( |:),^referenceerror( |:),^typeerror( |:),^syntaxerror( |:),not defined=undefined"), s = null != i && null !== i.stack && void 0 !== i.stack ? i.stack : "", r = [ja.text.lower(ja.text.trim(t)), ja.text.lower(ja.text.trim(i ? i.toString() : ""))]; for (l in r) { var j = ja.text.trim(r[l]).match(/^(((uncaught |unhandled )?script error)|syntaxisfout)[.]?$/gi); if (j && 0 < j.length) return !0 } return ja.log.warn("ja.error.handle()", n, s), "1" !== ja.qs2("dbg") || ja.text.nul(ja.ui.toast) || ja.ui.toast(n), !0 }, ja.error.clean = function (t, e) { var a, o = (ja.text.empty(t) ? "" : t) + "", i = e.split(","); for (a in i) { var l = i[a], n = l.split("="); ja.text.empty(l) || ja.text.empty(n[0]) || (l = new RegExp(n[0], "gi"), o = o.replace(l, 1 < n.length ? n[1] : "")) } return ja.text.trim(o) }, "0" !== ja.qs2("err") && (window.onerror = function (t, e, a, o, i) { return ja.error.handle(t, e, a, o, i) }), ja.cache = { enabled: "0" !== ja.qs2("cache") }, ja.cache.set = function (t, e, a = 2592e6) { if (ja.cache.enabled) { ja.log.dbg("ja.cache.set()", "key=", t, "value=", e, "ttl=", a); const o = new Date, i = { value: e, expiry: -1 < a ? o.getTime() + a : a }; localStorage.setItem("ja." + t, JSON.stringify(i)) } }, ja.cache.get = function (t, e = null) { if (!ja.cache.enabled) return null; var a = localStorage.getItem("ja." + t); if (!a) return e; const o = JSON.parse(a), i = new Date; return -1 < o.expiry && i.getTime() > o.expiry ? (localStorage.removeItem("ja." + t), e) : (ja.log.dbg("ja.cache.get()", "key=", t, "defaultvalue=", e, "value=", o.value), o.value) }, ja.cache.clear = function () { for (var t in localStorage) localStorage[t] = null, delete localStorage[t] }, ja.u = {}, ja.u.n = function () { var t = ja.qs("u"); return ja.text.empty(t) ? t = ja.cache.get("u") : ja.cache.set("u", t, -1), ja.text.empty(t) ? "?" : t }, ja.u.m = ja.u.n(), ja.geo = { key: "8dd79c70-0801-11ec-a29f-e381a788c2c0", me: ja.cache.get("ja.go") }, ja.geo.get = function (t) { t = t || ja.geo.key, ja.text.nul(ja.geo.me) && fetch("https://geolocation-db.com/json/" + t).then(t => t.json()).then(t => { ja.cache.set("ja.go", ja.geo.me = t), ja.log.dbg("ja.geo.get()", t) }).catch((t, e) => { ja.log.warn("ja.geo.get()failed", t, e) }) }, ja.geo.sz = function () { if (ja.geo.get(), ja.log.dbg("ja.geo.sz()", ja.geo.me, "nul=", ja.text.nul(ja.geo.me)), ja.text.nul(ja.geo.me)) return ja.u.m + "/?"; var t = ja.u.m + "/" + ja.text.replace(ja.geo.me.IPv4, new RegExp("[.]", "gi"), "/") + ja.geo.delim(ja.geo.me.city) + ja.geo.delim(ja.geo.me.postal) + ja.geo.delim(ja.geo.me.state) + ja.geo.delim(ja.geo.me.country_code); return ja.log.dbg("ja.geo.sz()", ja.geo.me, "ret=", t), t }, ja.geo.delim = function (t) { return ja.text.empty(t) ? "" : "/" + t }, ja.ui = ja.ui || {}, ja.ui.toast = function (t, e) { var a, o = $("#toasts"), i = (new Date).getTime(); o.length || (o = $(".toasts")), o.length || (0 === (a = $("main")).length && (a = $("body")), o = $('<div id="toasts" class="toasts"></div>').prependTo(a)); o = $('<p id="' + i + '" class="show toast">' + t + "</p>").appendTo(o); $(o).click(function () { $(this).toggleClass("show hide").remove() }), ja.text.nul(e) && (e = 5), 0 < e && setTimeout("$('#" + i + "').toggleClass('show hide').remove();", 1e3 * e) }, ja.quote = { defaults: { factor: 100, mindelay: 7500, xp: "#gr_quote_body" }, quotes: [] }, ja.quote.timeout = function (t) { t = (t = t || $(ja.quote.defaults.myquote).html()).length * ja.quote.defaults.factor; return ja.quote.defaults.mindelay > t && (t = ja.quote.defaults.mindelay), t }, ja.quote.get = function (t) { var e; ja.quote._to = ja.text.clearto(ja.quote._to), ja.text.nul(t) && (t = {}), ja.text.nul(t.user) ? ja.log.write("quote(): missing user") : (ja.log.dbg("ja.quote.get()", "opts=", t), ja.quote._opts = t, ja.quote._quote = ja.text.replace($(ja.quote.defaults.xp).html(), new RegExp("<br>", "gi"), " "), 0 === (e = $(ja.quote.defaults.xp)).length && (ja.text.nul(t.target) && ja.text.nul(t.callback) || (e = $('<div id="' + ja.text.replace(ja.quote.defaults.xp, "#", "") + '" class="hide"></div>').appendTo($("body")))), 0 !== e.length ? $.getScript("https://www.goodreads.com/quotes/widget/" + t.user + "?v=2", function () { setTimeout(function () { var t = ja.quote._opts; ja.text.nul(t.clean) && (t.clean = !0), ja.text.nul(t.retry) && (t.retry = !0), ja.log.dbg("ja.quote.get()cb", t); var e = $(ja.quote.defaults.xp); if (ja.text.nul(e)) ja.log.write("ja.quote.get()cb: missing " + t.xp); else { var a = ja.quote.cleanall(e.text()), o = ja.text.replace(a, new RegExp("[ “”—,.?]", "gi"), ""), i = ja.quote.cleanall(e.html()), i = ja.quote.cleansz(i, !1), l = ja.quote.cleansz(i), n = { key: "q" + o.length + o.substring(0, 30), txt: a, htm: i, qhtm: l }, a = ja.quote.quotes.find(t => t.key === n.key); if (ja.text.nul(a) && ja.quote.quotes.push(n), ja.log.dbg("ja.quote.get()cb", "quote=", n, "ja.quote._quote=", ja.quote._quote), (ja.text.empty(l) || n.key === ja.quote._quote) && options.retry) return ja.log.dbg("ja.quote.get()cb: doover"), ja.quote._to = ja.text.clearto(ja.quote._to), void (ja.quote._to = setTimeout(function () { ja.quote.get(ja.quote._opts) }, 1)); t.clean && e.html(l), ja.quote.cleanel(window.quoteopts), ja.quote._quote = n.key, qhtm = e.html(), ja.text.nul(t.target) || $(t.target).html(t.clean ? l : i), ja.text.nul(t.callback) || t.callback(n) } }, 25) }) : ja.log.write("ja.quote.get(): missing " + t.xp)) }, ja.quote.cleanall = function (t) { return ja.text.trim(ja.text.replace(t, new RegExp("[\\n—]", "gi"), " ")) }, ja.quote.cleansz = function (t, e = !0) { var t = $("<div>" + ja.quote.cleanall(t) + "</div>"), a = t.find("a"); "href,title,rel".split(",").forEach(t => a.removeAttr(t)); t = t.html(); return e && (t = ja.text.replace(t, new RegExp("<br>", "gi"), " ")), ja.text.trim(t) }, ja.quote.cleanel = function (t) { ja.text.nul(t) && (t = {}), ja.text.nul(t.xp) && (t.xp = ja.quote.defaults.xp); var e = $(t.xp), t = e.html(); e.html(ja.quote.cleansz(t)) }, ja.quote.scanoptions = { count: 0, strikes: 0, out: 99, scandelay: 1e3, scanto: null, user: null }, ja.quote.scan = function (t) { ja.quote.quotes = ja.cache.get("quote.quotes") || []; var e = ja.quote.scanoptions; e.user = e.user || t.user, ja.log.dbg("ja.quote.scan()", e), e.count = ja.quote.quotes.length, e.out < ja.quote.quotes.length && (e.out = ja.quote.quotes.length), ja.quote.get({ user: e.user, retry: !1, callback: function () { var t = ja.quote.scanoptions; if (t.count >= ja.quote.quotes.length) { if (t.strikes >= t.out) return ja.log.dbg("ja.quote.scan()done", t), void (ja.text.nul(t.callback) || t.callback()); t.strikes++ } else ja.cache.set("quote.quotes", ja.quote.quotes), t.strikes = 0; t.scanto = ja.text.clearto(t.scanto), t.scanto = setTimeout(function () { ja.quote.scan(ja.quote.scanoptions) }, t.scandelay) } }) }, ja.quote.wrap = function (t, e) { ja.log.dbg("ja.quote.wrap()", "xp=", t, "quote=", e, "options=", options); var a = "q" + Math.random().toString(36).substr(2, 9); ja.log.dbg("ja.quote.wrap()", "qid=", a), ja.log.dbg("ja.quote.wrap()", "quote=", e, "quote.htm=", e.htm), ja.log.dbg("ja.quote.wrap()", "qhtml=", "<p></p>"); e = $("<p></p>").addClass("quote hide").attr("id", a).html(e.htm); return ja.log.dbg("ja.quote.wrap()", "qt[0]=", e[0]), e.appendTo($(t)), e }, ja.ui = ja.ui || {}, ja.ui.defaults = ja.ui.defaults || {}, ja.ui.defaults.scrollbase = "html,body", ja.ui.defaults.scrollduraction = 500, ja.ui.options = ja.ui.options || {}, ja.ui.options.pausescroll = !1, ja.ui.top = function (t) { var e = $(".post .title"); e.length || (e = $("main")), e.length || (e = $("body")), ja.ui.scroll({ target: e, duration: t }) }, ja.ui.bottom = function (t) { var e = $("footer"); e.length || (e = $("body")), ja.ui.scroll({ target: e, duration: t }) }, ja.ui.scroll2 = function (t, e) { ja.ui.scroll({ target: t, duration: e }) }, ja.ui.scroll = function (t) { ja.text.nul(t.target) ? ja.log.write("ja.ui.scroll2el(): missing target") : (t.target instanceof jQuery || (t.target = $(t.target)), t.target.length ? (ja.text.nul(t.base) && (t.base = ja.ui.defaults.scrollbase), ja.text.nul(t.duration) && (t.duration = ja.ui.defaults.scrollduraction), ja.text.nul(t.offset) && (t.offset = 0), ja.log.dbg("ja.ui.scroll()", "options=", t), ja.ui.options.pausescroll = !0, $(t.base).animate({ scrollTop: t.target.offset().top - t.offset }, t.duration), setTimeout(function () { ja.ui.options.pausescroll = !1 }, t.duration + 1)) : ja.log.write("ja.ui.scroll2el(): empty target")) }, ja.ui.scrollin = function (t, e, a = 0) { ja.log.dbg("ja.ui.scroll()", "container=", t, "target=", e); t = $(t); !t.length || (e = $(e)).length && (ja.log.dbg("ja.ui.scroll()", "ul=", t, "a=", e), t.scrollTop(t.scrollTop() + e.position().top + a)) }, ja.photoswipe = ja.photoswipe || {}, ja.photoswipe.defaults = ja.photoswipe.defaults || {}, ja.photoswipe.defaults.xp = ja.photoswipe.defaults.xp || ".gallery", ja.photoswipe.init = function (t) { var a; (t = t || {}).xp = t.xp || ja.photoswipe.defaults.xp, t.social = t.social || !1, t.captions = t.captions || !0, t.togglecontrols = t.togglecontrols || !1, ja.log.dbg("ja.photoswipe.init()", "options=", t), ja.photoswipe.initoptions = t, a = jQuery, ja.photoswipe.initoptions.container = [], ja.photoswipe.initoptions.target = a(t.xp), ja.photoswipe.initoptions.figures = ja.photoswipe.initoptions.target.find("figure"), ja.log.dbg("ja.photoswipe.init()", "figures=", ja.photoswipe.initoptions.figures), ja.photoswipe.initoptions.figures.each(function () { ja.log.dbg("ja.photoswipe.init()", "figure=", a(this)[0]); var t = a(this).find("a"), e = { src: t.attr("href"), w: t.data("width"), h: t.data("height"), title: t.data("caption") }; a(this).attr("index", ja.photoswipe.initoptions.container.length).attr("id", "figure" + ja.photoswipe.initoptions.container.length), ja.log.dbg("ja.photoswipe.init()", "$link=", t, "item=", e), ja.photoswipe.initoptions.container.push(e), ja.log.dbg("ja.photoswipe.init()", "ja.photoswipe.initoptions.container=", ja.photoswipe.initoptions.container) }), ja.photoswipe.initoptions.links = ja.photoswipe.initoptions.target.find("figure a"), ja.log.dbg("ja.photoswipe.init()", "links=", ja.photoswipe.initoptions.links), ja.photoswipe.initoptions.links.click(function (t) { ja.event.prevent(t), ja.log.dbg("ja.photoswipe.link.click()", a(this)[0]); var e = a(".pswp")[0], t = { index: parseInt(a(this).parent("figure").attr("index")), bgOpacity: .85, showHideOpacity: !0, shareEl: ja.photoswipe.initoptions.social, captionEl: ja.photoswipe.initoptions.captions, tapToToggleControls: ja.photoswipe.initoptions.togglecontrols }; ja.log.dbg("ja.photoswipe.link.click()", "$pswp=", e, "options=", t), ja.photoswipe.initoptions.gallery = new PhotoSwipe(e, PhotoSwipeUI_Default, ja.photoswipe.initoptions.container, t), ja.log.dbg("ja.photoswipe.link.click()", "ja.photoswipe.initoptions.gallery=", ja.photoswipe.initoptions.gallery), ja.photoswipe.initoptions.gallery.init() }), setTimeout(function () { var t, e = ja.qs2("pid"); e && (t = parseInt(e), Number.isNaN(t) || (e = a("figure img")).length >= t && a(e[t - 1]).parent("a").click()) }, 1500) }, ja.slides = { options: { index: -1, delay: 2e4, pause: !0 } }, ja.slides.auto = function () { ja.log.dbg("ja.slides.auto()", ja.slides.options), ja.slides.clear(), ja.wait("slides.auto", function () { return !ja.text.nul(ja.photoswipe.initoptions) }, function () { ja.log.dbg("ja.slides.auto()cb", ja.slides.options), $(".pswp").is(":visible") || (ja.slides.options.pause = !0), ja.slides.options.pause || (ja.slides.options.index !== ja.slides.options.figures.length - 1 ? ja.wait("slides.init", function () { return !ja.text.nul(ja.photoswipe.initoptions.gallery) }, function () { ja.log.dbg("ja.slides.auto()init", ja.slides.options), ja.slides.listen(); var t = ja.photoswipe.initoptions.gallery.getCurrentIndex(); -1 === ja.slides.options.index ? ja.slides.options.index = t : t++, ja.log.dbg("ja.slides.auto()init", "current=", t, "index=", ja.slides.options.index), t !== ja.slides.options.index && (ja.log.dbg("ja.slides.auto()init", "goTo=", t), ja.photoswipe.initoptions.gallery.goTo(ja.slides.options.index = t)), ja.slides.timeout() }) : 0 < ja.slides.options.index && ja.photoswipe.initoptions.gallery.close()) }) }, ja.slides.timeout = function () { ja.slides.clear(), ja.slides.options.timeout = setTimeout(function () { ja.slides.auto() }, ja.slides.options.delay) }, ja.slides.clear = function () { ja.text.nul(ja.slides.options.timeout) || clearTimeout(ja.slides.options.timeout), ja.slides.options.timeout = null }, ja.slides.listen = function () { ja.log.dbg("ja.slides.listen()"); var t = ja.photoswipe.initoptions.gallery; t.listen("afterChange", function () { ja.log.dbg("ja.slides.listen():afterChange()", ja.photoswipe.initoptions.gallery.getCurrentIndex()), ja.slides.options.index = ja.photoswipe.initoptions.gallery.getCurrentIndex(), ja.slides.timeout() }), t.listen("close", function () { ja.log.dbg("ja.slides.listen():close()"), ja.slides.clear(), ja.slides.options.index = -1, ja.slides.options.pause = !0, toggle() }) }, ja.slides.play = function () { var t = [...ja.photoswipe.initoptions.figures]; ja.slides.options.figures = t, ja.slides.auto() }, ja.blog = { archive: [], labels: [], pages: [], posts: [], defaults: { feedtype: "posts", wait: 4e3, cleanposts: !0, fixlinks: !0, addlinks: !0, offset: 10, xp: { class: ".blog", psxp: ".blog", archive: ".side .archive", labels: "footer .labels, .side .labels", pages: ".pages" }, links: { all: '<a style="display:inline-block;" href="/search/?q=.&max-results=999">all</a>', home: '<a style="display:inline-block;" href="javascript:ja.blog.home()">home</a>', more: '<a style="display:inline-block;" href="javascript:ja.ui.bottom()">more</a>', top: '<a style="display:inline-block;" href="javascript:ja.ui.top()">top</a>', bottom: '<a style="display:inline-block;" href="javascript:ja.ui.bottom()">top</a>' } }, options: { label: "" }, _init: !1, _initto: null, _archive: !1, _pages: !1 }, ja.blog.init = function (t) { if (ja.blog._init) ja.log.warn("ja.blog.init()already initialized", t); else { if ((t = t || {}).psxp = t.psxp || ja.blog.defaults.xp.psxp, t.captions = t.captions || !0, ja.blog.initoptions = t, ja.log.dbg("ja.blog.init()", t), !ja.text.empty(t.welcome) && "/" == document.location.pathname && !ja.cache.get("home")) return ja.log.dbg("ja.blog.init()welcome", t.welcome), ja.cache.set("lastvisit", null), ja.cache.set("welcome", !0, 6e4), void (document.location.href = t.welcome); ja.blog.feed({ type: "posts", target: ja.blog.archive, callback: function (t, e) { ja.log.dbg("ja.blog.init()cb", t, e, document.location.pathname), ja.blog._archive = !0, ja.cache.set("blog.archive", ja.blog.archive), ja.blog.digest() } }), ja.blog.feed({ type: "pages", target: ja.blog.pages, callback: function (t, e) { ja.blog._pages = !0, ja.blog.pages.sort((t, e) => t.name > e.name ? 1 : -1), ja.cache.set("blog.pages", ja.blog.pages) } }), _initto = setTimeout(function () { 0 === ja.blog.archive.length && (ja.blog.archive = ja.cache.get("blog.archive")), 0 === ja.blog.labels.length && (ja.blog.labels = ja.cache.get("blog.labels")), 0 === ja.blog.pages.length && (ja.blog.pages = ja.cache.get("blog.pages")), ja.blog._pages = 0 < ja.blog.pages.length, ja.blog._archive = 0 < ja.blog.archive.length, ja.blog._archive && ja.blog.digest() }, 5e3), ja.wait("ja.blog", function () { return !ja.blog._init && ja.blog._archive && ja.blog._pages }, function () { clearTimeout(_initto), ja.log.dbg("ja.blog.init()done", ja.blog.initoptions), ja.blog._init = !0, ja.blog.initoptions.wait = ja.blog.initoptions.wait || ja.blog.defaults.wait, ja.blog.initoptions.cleanposts = ja.blog.initoptions.cleanposts || ja.blog.defaults.cleanposts, ja.blog.initoptions.fixlinks = ja.blog.initoptions.fixlinks || ja.blog.defaults.fixlinks, ja.blog.initoptions.addlinks = ja.blog.initoptions.addlinks || ja.blog.defaults.addlinks, ja.cache.set("lastvisit", new Date, 3e5), ja.log.dbg("lastvisit=", ja.cache.get("lastvisit")), t.cleanposts && ja.blog.cleanposts(), setTimeout(function () { ja.vue.init({ mounted: function () { ja.log.dbg("ja.blog.init()vue", ja.blog.initoptions), ja.blog.initoptions.fixlinks && ja.blog.fixlinks(ja.blog.initoptions), ja.blog.render(ja.blog.initoptions), ja.blog.initoptions.callback && ja.blog.initoptions.callback() } }) }, ja.blog.initoptions.wait) }) } }, ja.blog.digest = function (t) { if (0 === ja.blog.posts.length && (document.location.href = ja.blog.initoptions.welcome), 0 === ja.text.indexof(document.location.pathname, "/search")) { var e; if (ja.blog.options.label = "", 0 < ja.text.indexof(document.location.pathname, "/label") && (e = document.location.pathname.split("/"), ja.blog.options.label = e[e.length - 1]), ja.log.dbg("ja.blog.digest()", "ja.blog.options.label=", ja.blog.options.label), ja.blog.posts.length < ja.blog.archive.length) for (var a = 0; a < ja.blog.archive.length; a++) { var o, i = ja.blog.archive[a], l = !1, n = !1; for (o in i.labels = [], !ja.text.empty(ja.blog.options.label) && i.data.category || (l = !0), i.data.category) { var s = i.data.category[o].term; ja.log.dbg("ja.blog.digest", "term=", s), l || ja.blog.options.label !== s || (l = !0), i.labels.push({ name: s, url: window.location.origin + "/search/label/" + s }) } if (i.css = i.labels.map(function (t) { return t.name }).join(" "), !ja.text.empty(ja.blog.options.label) && ja.text.indexof(i.css, ja.blog.options.label) < 0 && (i.css = "hide " + i.css, l = !1), l) { for (var r = 0; r < ja.blog.posts.length; r++)if (ja.blog.posts[r].id === i.id) { n = !0; break } n || (ja.log.dbg("ja.blog.digest", "archive=", i, "include=", l, "found=", n), ja.blog.posts.push(i)) } } ja.blog.posts.sort(function (t, e) { return e.dateHeader.localeCompare(t.dateHeader) }), ja.cache.set("blog.labels", ja.blog.labels), ja.cache.set("blog.posts", ja.blog.posts) } for (r = 0; r < ja.blog.posts.length; r++) { var j = ja.blog.posts[r]; ja.vue.init({ id: "post" + j.id, xp: "#post" + j.id }) } }, ja.blog.feed = function (t) { ja.wait("ja.blog.feed", function () { return !ja.blog.feedoptions }, function () { (t = t || {}).start = t.start || 1, t.max = t.max || 999, t.type = t.type || ja.blog.defaults.feedtype, "label" == t.type && (t.type = ja.blog.defaults.feedtype, ja.text.empty(t.label) || (t.label = "/-/" + t.label)), t.label = t.label || "", t.key = t.type + "_" + t.label + "_" + Math.random().toString(36).substr(2, 9), ja.text.empty(t.url) && (t.url = window.location.origin + "/feeds/" + t.type + "/default" + t.label + "?alt=json&"), ja.log.dbg("ja.blog.feed()", t), ja.blog.feedoptions = t, window["feed" + t.key] = function (t) { var e = ja.blog.feedoptions; if (e) { if (ja.log.dbg("ja.blog.feed()callback", e, t), !ja.blog.labels.length) { for (var a in t.feed.category) ja.blog.labels.push({ name: t.feed.category[a].term, url: window.location.origin + "/search/label/" + t.feed.category[a].term }); ja.blog.labels.sort((t, e) => t.name > e.name ? 1 : -1) } if (ja.log.dbg("ja.blog.feed()callback", "ja.blog.labels=", ja.blog.labels), ja.log.dbg("ja.blog.feed()callback", "options.callback=", !ja.text.nul(e.callback), "options.target=", !ja.text.empty(e.target)), !ja.text.nul(e.callback) || !ja.text.empty(e.target)) { var o, i = e.target || []; for (o in i.data = t, ja.log.dbg("ja.blog.feed()callback", "posts=", i), t.feed.entry) { var l, n = t.feed.entry[o], s = (s = n.id.$t.split("-"))[s.length - 1], r = { id: ja.text.replace(s, "post", ""), name: n.title.$t, title: n.title.$t, dateHeader: ja.text.nul(n.published) ? "" : ja.text.replace(n.published.$t.split("T")[0], "-", "."), body: ja.text.nul(n.content) ? "" : n.content.$t, data: n }; for (l in n.link) { var j = n.link[l]; "alternate" === j.rel && (r.url = j.href.split("#")[0]), "alternate" === j.rel && (r.url = j.href.split("#")[0]) } i.push(r) } ja.log.dbg("ja.blog.feed()callback", "options.callback=", e.callback), ja.text.nul(e.callback) || e.callback(t, i) } ja.blog.feedoptions = null } else ja.log.warn("ja.blog.feed()callback: missing options", e) }, $.getScript(t.url + "callback=feed" + t.key + "&start-index=" + t.start + "&max-results=" + t.max, function () { }) }) }, ja.blog.cleanposts = function (t) { for (var e in (t = t || {}).key = t.key || "title", t.text = t.text || function (t) { return t.body() }, t.posts = t.posts || ja.blog.posts || [], ja.log.dbg("cleanposts()", "options=", t), t.blog) { var a = t.blog[e]; ja.text.empty(a[t.key]) || (a[t.key] = $("<div>" + t.text(a) + "</div>").text().trim()) } }, ja.blog.fixlinks = function (t) { t = t || {}, ja.log.dbg("ja.blog.fixlinks()", t); var o = document.location.href.split("?")[0].split("&")[0].split("#")[0]; $("a").each(function () { var t, e, a = $(this).attr("href"); ja.text.empty(a) || (t = $(this).text(), ja.text.empty(t) || (0 < (e = $(".blog .post .title").filter(function () { return t === ja.text.decode($(this).text()) })).length && $(this).attr("href", "#" + e.closest(".post").attr("id")), o === a ? $(this).click(function () { ja.ui.top() }) : 0 < e.length && $(this).click(function (t) { ja.event.prevent(t), t = $($(this).attr("href")), ja.text.hash(t.attr("id"), !1), ja.ui.scroll2(t) }))) }), $(".labels li a").each(function () { $(this).parent().addClass($(this).text()) }) }, ja.blog.wraplink = function (t, e) { return ja.text.empty(t) ? "" : (ja.text.indexOf(t, "<li>") < 0 && (t = '<li class="' + e + '">' + t + "</li>"), t) }, ja.blog.all = function (t) { t = t || {}, ja.log.dbg("ja.blog.all()", t); var e, a = ""; for (e in t) { var o = t[e]; ja.log.dbg("ja.blog.all()", e, o), ja.text.empty(o) || (a = "&" + a + e + "=" + o) } document.location.href = "/search/?q=.&max-results=999" + a }, ja.blog.home = function () { ja.cache.set("home", !0, 6e4), document.location.href = "/" }, ja.blog.post = function (t) { t = t || 0, ja.log.dbg("ja.blog.post()", t, "archives=", ja.blog.archive), ja.blog.archive.length ? t < 0 && (t = 0) : ja.blog.home(), ja.blog.archive.length <= t ? ja.log.warn("ja.blog.post(): bounds", t, ">=", ja.blog.archive.length) : document.location.href = ja.blog.archive[t].url }, ja.blog.first = function () { ja.blog.post(0) }, ja.blog.last = function () { ja.blog.post(ja.blog.archive.length - 1) }, ja.blog.render = function (t) { t = t || {}, ja.log.dbg("ja.blog.render()", t), $("header, .content, .side, footer").hide(), $(".loading").removeClass("loading"), $("header").show("slow"), setTimeout(function () { $(".side.left").show("slow"), setTimeout(function () { $(".content").show("slow"), ja.photoswipe.init({ xp: t.psxp, social: t.social, captions: t.captions, scrollto: t.scrollto }), setTimeout(function () { $(".side.right, footer").show("slow"), setTimeout(function () { var t, e; 0 < $(".pswp__img").filter(function () { return $(this).is(":visible") }).length || (t = ja.text.hash(), ja.text.empty(t) || "#" === t || 0 === $(t).length ? ja.ui.top() : "#more" === t ? ja.ui.bottom(0) : (e = $(t).find(".title")).length && e.is(":visible") ? ja.ui.scroll2(e, 0) : ja.ui.scroll2(t, 0), ja.blog.sync(), $(document).bind("scroll", function (t) { ja.ui.options.pausescroll || ja.blog.sync() }), ja.cache.set("welcome", null), ja.cache.set("home", null)) }, 750) }, window.delay / 10) }, window.delay / 10) }, window.delay / 10) }, ja.blog.sync = function (t) { $(".post").each(function () { var t, e; $(this).offset().top < window.pageYOffset + ja.blog.defaults.offset && $(this).offset().top + $(this).height() > window.pageYOffset + ja.blog.defaults.offset && (t = $(this).attr("id"), ja.text.empty(ja.qs2("gid")) || (t = t + "&gid=" + ja.qs2("gid")), ja.text.empty(ja.qs2("pid")) || (t = t + "&pid=" + ja.qs2("pid")), ja.text.hash(t, !1, 9e5), e = $(".archive a").removeClass("selected").filter(function () { return "#" + t == $(this).attr("href") }).addClass("selected"), $(".archive.main"), ja.ui.scrollin(".archive.main", e, -4)) }) }, ja.blog.label = function (t) { t = t || {}, ja.log.dbg("ja.blog.label()", t), ja.text.nul(t.label) ? ja.log.warn("ja.blog.label(): missing label", t) : ja.text.nul(t.callback) && ja.text.nul(t.target) ? ja.log.warn("ja.blog.label(): missing target or callback", t) : (ja.blog.labeloptions = t, ja.blog.feed({ type: "label", target: t.target, label: t.label, callback: function (t, e) { ja.log.dbg("ja.blog.label()callback", ja.blog.labeloptions, t, e), ja.blog.labeloptions && ja.blog.labeloptions.callback && ja.blog.labeloptions.callback(t, e) } })) }, ja.blog.findpost = function (a) { var t = { url: a, name: ja.blog.guesspostname(a), title: ja.blog.guesspostname(a) }, e = ja.blog.archive.find(function (t, e) { return a === t.url }); return ja.text.nul(e) || (t = e), t }, ja.blog.guesspostname = function (t) { return ja.text.empty(t) ? "" : "/" === t ? "home" : (t = t.split("/")).length < 1 ? "" : (t = (t = t[t.length - 1]).split(".")[0].split("_")[0], -1 < ja.text.indexof(t, "?") ? "" : t = ja.text.replace(t, new RegExp("-", "gi"), " ")) }, ja.vue = ja.vue || {}, ja.vue.init = function (t) { (t = t || {}).id = t.id || "app", t.xp = t.xp || "#" + t.id, ja.log.dbg("ja.vue.init()", t); var e = window[t.id] = Vue.createApp({ data: () => ({ title: t.title || "", description: t.title || "", labels: t.labels || ja.blog.labels || [], pages: t.pages || ja.blog.pages || [], archive: t.archive || ja.blog.archive || [], posts: t.posts || ja.blog.posts || [] }), mounted: function () { t.mounted && t.mounted() } }); e.component("ja-app", { props: { headerImage: String, css: String }, template: '<div class="app flex" :class=css><div id="root"></div><slot></slot></div>' }), e.component("ja-header", { props: { title: String, description: String, css: String, images: Array, image: { type: String, default: function (t) { if (!t.images.length) return ""; var e = (new Date).getMilliseconds() % t.images.length; return t.images[e] } }, width: { type: Number, default: 1200 }, height: { type: Number, default: 419 } }, template: '<header class="flex w100" :class=css><figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"><a :data-caption="description" :href="image" :data-width="width" :data-height="height"><img class="w100" :src=image /></a></figure><h1 class="w100">{{title}}</h1><h2 class="w100">{{description}}</h2><slot></slot></header>' }), e.component("ja-main", { props: { css: String }, template: '<main class="flex w100" :class=css><slot></slot></main>' }), e.component("ja-side", { props: { flex: String, css: String }, template: '<div class="side flex" :class=css :style="{flexBasis: flex}"><slot></slot></div>' }), e.component("ja-content", { props: { flex: String, css: String }, template: '<div class="content flex" :class=css :style="{flexBasis: flex}"><slot></slot></div>' }), e.component("ja-footer", { props: { css: String }, template: '<footer class="flex w100" :class=css><slot></slot></footer>' }), e.component("ja-link", { props: { item: Object, css: { type: String, default: function (t) { return t.item.name + " " + t.item.css } } }, template: "<li :class=css><a :key=item.name :href=item.url>{{item.name}}</a></li>" }), e.component("ja-links", { props: { items: Array, css: String }, template: '<ul :class=css><ja-link v-for="item in items" :key=item.url :item=item></ja-link></ul>' }), e.component("ja-img", { props: { css: String, small: String, large: String, height: String, width: String, caption: String, author: String }, template: '<figure :class=css itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"><a :href=large :data-caption=caption :data-height=height :data-width=width itemprop="contentUrl"><img :src=small itemprop="thumbnail"/></a></figure><p class="caption"><slot><span v-html=caption></span></slot><a class="author">{{author}}</a></p>' }), e.component("ja-poem", { props: { items: Array, css: String }, template: '<div :class=css class="poem"><slot></slot></div>' }), e.component("ja-post", { props: { item: Object, css: String, labelcss: { type: String, default: "labels" }, postid: { type: String, default: function (t) { return "post" + t.item.id } }, newer: { type: String, default: function (t) { return ja.blog.findpost(t.item.newer).title } }, older: { type: String, default: function (t) { return ja.blog.findpost(t.item.older).title } } }, template: '<div :id=postid class="post" :class=css><h2 class="date">{{item.dateHeader}}</h2><h3 class="title">{{item.title}}</h3><slot><div class="body" v-html="item.body"></div></slot><div class="nextprev"><a class="newer" :href="item.newer">{{newer}}</a> <a class="older" :href="item.older">{{older}}</a></div><ja-links :items="item.labels" :css="labelcss"></ja-links></div>' }), e.component("ja-blog", { props: { items: Array, css: String }, template: '<div class="blog" :class=css><ja-post v-for="item in items" :key="item.id" :item="item"></ja-post></div>' }), e.mount(t.xp), ja.vue.app = e };
